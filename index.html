<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UGN Mission Partners Map</title>
  <style>
    /* Map container */
    #map {
      width: 100%;
      height: 90vh; /* Adjust height as needed */
    }

    /* Location panel */
    #location-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 300px;
      max-height: 80vh;
      background: #fff;
      border: 1px solid #ddd;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      overflow-y: auto;
      padding: 10px;
      z-index: 1000;
    }

    #search-bar {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #location-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #location-list li {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }

    #location-list li:hover {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <!-- Map Container -->
  <div id="map"></div>

  <!-- Location Panel -->
  <div id="location-panel">
    <input type="text" id="search-bar" placeholder="Search locations...">
    <ul id="location-list"></ul>
  </div>

  <!-- Google Maps Script -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>

  <!-- Main JavaScript -->
  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/10YA-1CHFMSlWdhf5J8jrMnJc9k9VyzWC0TU6Xousp6U/gviz/tq?tqx=out:json&sheet=UGN%20Mission%20Partners";
    const markers = [];
    let map;

    // Initialize the Google Map
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,
        center: { lat: 37.7749, lng: -122.4194 } // Default center
      });

      // Fetch locations from the Google Sheet
      fetch(sheetUrl)
        .then(response => response.text())
        .then(data => {
          const json = JSON.parse(data.substring(47).slice(0, -2));
          const rows = json.table.rows;
          const locationList = document.getElementById("location-list");

          rows.forEach(row => {
            const name = row.c[0]?.v || "No name";
            const lat = parseFloat(row.c[1]?.v);
            const lng = parseFloat(row.c[2]?.v);

            if (!isNaN(lat) && !isNaN(lng)) {
              // Add markers to the map
              const marker = new google.maps.Marker({
                position: { lat, lng },
                map: map,
                title: name,
              });

              markers.push(marker);

              // Add locations to the list
              const listItem = document.createElement("li");
              listItem.textContent = name;
              listItem.addEventListener("click", () => {
                map.setCenter({ lat, lng });
                map.setZoom(14);
              });
              locationList.appendChild(listItem);
            }
          });
        })
        .catch(error => console.error("Error fetching sheet data:", error));
    }

    // Handle search functionality
    document.getElementById("search-bar").addEventListener("input", function () {
      const query = this.value.toLowerCase();

      // Filter markers and list items
      markers.forEach(marker => marker.setMap(null)); // Clear all markers
      const locationList = document.getElementById("location-list");
      locationList.innerHTML = ""; // Clear the list

      markers.forEach((marker, index) => {
        if (marker.title.toLowerCase().includes(query)) {
          marker.setMap(map); // Show filtered markers

          // Add filtered locations to the list
          const listItem = document.createElement("li");
          listItem.textContent = marker.title;
          listItem.addEventListener("click", () => {
            map.setCenter(marker.getPosition());
            map.setZoom(14);
          });
          locationList.appendChild(listItem);
        }
      });
    });

    // Load the map
    window.onload = initMap;
  </script>
</body>
</html>
